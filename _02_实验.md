## 实验2

---

> 1. 用open()、read()、write()函数，实现从一个文件（源文件）中读取最后10B数据并到另一个文件（目标文件）。要求：源文件以只读方式打开，目标文件是以读写方式打开。若目标文件不存在，可以创建并设置权限的初始值为644，即文件所有者可读可写，文件所属组和其他用户只能读，源文件内容为“日期+学号”，如当前日期为2015年9月7日，学号为123450001，则源文件内容为“201509071234500001”。

> 2. 编写文件读写锁的测试程序，要求测试程序自动创建一个名为“locktest”的文件，先对其加写入锁，按任意键后释放写入锁，再按任意键后加读取锁，然后按任意键后释放读取锁，最后再次按任意键退出程序。**要求所加的读写锁是强制性锁。**

> 3. 用文件I/O函数编写程序，实现数据从源文件到目标文件的转移，即从源文件中读取前面若干字符送到目标文件中，并把源文件中已传送的数据删除。要求：
>
> ```c
> 1)程序包含两部分，分别是生成源文件的生产程序“prod.c”和传输数据到目标文件并删除源文件中已传输数据的转移程序“move.c”；
> 2)生产程序功能：
> ①以读写方式打开源文件，若源文件不存在，可以创建并设置权限的初始值为0644；若文件已存在，将文件的内容展示到屏幕上；
> ②自动向源文件中生成字符，字符包括数字和字母，先生成数字，紧接着生成字母，从0开始，0…9a…z作为一个循环，一个循环过后，从0开始重复，例如源文件中生成的字符为“0123456789abcdefghijklmnopqrstuvwxyz0123……”；
> ③生成字符的周期以及要生成的字符数可以通过参数传递给进程（默认生成数字的周期为0.2秒，生产40个字符）；
> ④向文件中写入时给文件加写入锁，写入完成后解锁；
> 3)转移程序功能：
> ①转移程序按照指定位置和数目进行字符转移；
> ②首先将源文件的内容展示到屏幕上，询问用户要转移的字符位置和转移的字符数，按照用户的要求从源文件中指定的位置读取相应数目的字符，并转移到目标文件，然后从源文件中删除刚才传输过的数据，最后把目标文件的内容展示到屏幕上。
> ③每次转移的字符数通过用户输入传给进程，用户也可以不做任何输入，直接回车使用默认值，默认值为从文件开头开始，共计5个字符；
> ④向文件中写入时给文件加写入锁，写入之后解锁。
> ```

---

*

*

*

*

*

*

**

*

*

*

*

*

*

**

*

*

*

*

*

*

**

*

*

*

*

*

*

**

*

*

*

*

*

*

**

*

*

*

*

*

*

**

*

*

*

*

*

*

**

---

### 实验讲解

