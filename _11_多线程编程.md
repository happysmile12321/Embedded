## 多线程编程

### 线程概念
> 进程拥有`数据段、代码段和堆栈段`。  
> 在进程间切换CPU要进行复杂的上下文切换。  
> 线程应运而生。

### 线程的特点  
- 进一步减少处理机的空转时间
- 支持多处理器
- 上下文切换开销极小
	- 上下文切换：CPU的控制权由运行任务转移到另外一个就绪任务时所发生的事件，主要包括保存当前任务的运行环境、恢复将要运行任务的运行环境。
	- 由运行态转化为就绪态
- 在用户态编写多条线程，传入内核态就是一条线程
- 进程就是一条主线程 
   

### 线程的实现

同进程一样，线程也将相关的执行状态和存储变量放在线程控制表内。  

一个进程可以有多个线程，也就是有多个线程控制表及堆栈寄存器，但却共享一个用户地址空间。 
 
因此，任何线程对系统资源的操作都会给其他线程带来影响。

由此可知，`多线程中的同步是非常重要的问题`。
[^note]:这里的同步采用了一种更为简单的PV操作。(而且是无名的PV操作)

	一个标准的线程由线程ID，当前指令指针(PC），寄存器集合和堆栈组成。

	一个线程可以创建和撤消另一个线程，同一进程中的多个线程之间可以并发执行。	

	线程也有就绪、阻塞和运行三种基本状态。

	每一个程序都至少有一个线程，若程序只有一个线程，那就是程序本身。

	多线程：如聊天过程中，server和client可以在各自的进程中创建2个线程，一个负责接受信息，一个负责发送信息，即可实现同时收发。

---



